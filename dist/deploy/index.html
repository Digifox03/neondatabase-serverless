<style>
  pre {
    font: 13px Monaco, Menlo, monospace;
  }

  .live {
    color: #aaa;
  }

  .median {
    color: #fff;
    background: #000;
    ;
  }
</style>
<script type="module">
  import main from './index.js';

  // shim req
  const req = {};

  // shim env
  const resp = await fetch('/.dev.vars');
  const text = await resp.text();
  const env = text.split('\n').reduce((memo, line) => {
    const eqIndex = line.indexOf('=')
    if (!line.match(/^\s*#/) && eqIndex > 0) {
      memo[line.substring(0, eqIndex)] = line.substring(eqIndex + 1);
    }
    return memo;
  }, {});

  // shim ctx
  const ctx = { waitUntil(promise) { } };  // browser always waits!

  const pre = document.querySelector('pre');

  // shim the Response object
  globalThis.Response = function (data) {
    // pre.innerText = data;
  }

  const log = (s) => pre.innerHTML += s;

  // run the worker
  main.fetch(req, env, ctx, log);
</script>
<pre></pre>